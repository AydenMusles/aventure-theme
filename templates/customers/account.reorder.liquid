<div class="page-width pt-45">
  <div class="grid">
    <div class="grid__item grid__item--content">

      <h1 class="text-center mb-40" itemprop="name">{{ 'customer.account.reorder.title' | t }}</h1>

      <div class="rte text-center">
        {{ 'customer.account.reorder.description' | t }}
      </div>
      <hr class="hr--clear hr--small">

      {% comment %} Creates an array of products already bought by the customer {% endcomment %}
      {% comment %} Problème connu: sorting par quantité ne prend pas en compte la quantité totale commandée mais la quantité max commandée au cours du temps {% endcomment %}
      {% assign bought_products = "" | split: ',' %}
      {% for order in customer.orders %}
        {% assign bought_products = bought_products | concat: order.line_items %}
      {% endfor %}

      {% comment %} option1 {% endcomment %}
      {% assign bought_products = bought_products | sort: 'quantity' | reverse | map: 'product' | map: 'handle' | uniq %}

      {%- assign per_row = 5 -%}

      <div class="page-width">
        <div class="grid grid--uniform grid--collection">
          {%- assign grid_item_width = 'small--one-half medium-up--one-third' -%}

          {% case per_row %}
          {% when 2 %}
            {%- assign grid_item_width = 'medium-up--one-half' -%}
          {% when 3 %}
            {%- assign grid_item_width = 'small--one-half medium-up--one-third' -%}
          {% when 4 %}
            {%- assign grid_item_width = 'small--one-half medium-up--one-quarter' -%}
          {% when 5 %}
            {%- assign grid_item_width = 'small--one-half medium-up--one-fifth' -%}
          {% endcase %}

          {% paginate collections["all"].products by 10000 %}
            {% for product in collections["all"].products %}
              {% if bought_products contains product.handle %}
                {% if product.available %}
                  {% include 'product-grid-item' %}
                {% endif %}
              {% endif %}
            {% endfor %}
          {% endpaginate %}

        </div>
      </div>
    </div>
  </div>
</div>
